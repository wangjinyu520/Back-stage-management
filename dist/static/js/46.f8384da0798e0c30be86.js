webpackJsonp([46],{ERKo:function(t,i,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=o("woOf"),c=o.n(e),s=o("mvHQ"),a=o.n(s),r=o("bOdI"),n=o.n(r),l=o("wc4o"),d=o("KA92"),m=o("zL8q"),u=o("G0J2"),p=o("+yKa"),h=(o("3f40"),o("4qOc"),o("+cgv"),{name:"GoodsEdit",components:{quillEditor:u.quillEditor},data:function(){var t;return t={gdialogVisible:!1,gdialogImageUrl:"",dialogVisible:!1,dialogImageUrl:"",quillOption:p.a,editor:null,params:new FormData},n()(t,"dialogImageUrl",""),n()(t,"fileList",[]),n()(t,"dat",{content:""}),n()(t,"ueditor",{value:"编辑器默认文字",config:{initialFrameWidth:800,initialFrameHeight:320}}),n()(t,"uploadPath",d.c),n()(t,"commodityIconArray",[]),n()(t,"newKeywordVisible",!1),n()(t,"newKeyword",""),n()(t,"selectProductTypeValue",null),n()(t,"keywords",[]),n()(t,"brandOptions",[]),n()(t,"productType",[]),n()(t,"categoryList",[]),n()(t,"commodity",{commodityId:"",commodityName:"",commodityType:"",salePrice:"",purchasePrice:"",isScoreProduct:"",scoreProportion:"",commodityIcon:"",rent:"",location:"",unit:"",specification:"",productionPlace:"",productProfile:"",material:"",description:"",model:"",brand:""}),n()(t,"productTypeOptions",[]),n()(t,"specVisiable",!1),n()(t,"specForm",{specification:"",value:"",picUrl:""}),n()(t,"specifications",[{specification:"规格",value:"标准",picUrl:""}]),n()(t,"productVisiable",!1),n()(t,"productForm",{id:0,specifications:[],salePrice:0,stock:0,url:""}),n()(t,"stocks",[{stockId:0,specifications:["标准"],salePrice:0,stock:0,url:""}]),n()(t,"attributeVisiable",!1),n()(t,"attributeForm",{attribute:"",value:""}),n()(t,"attributes",[]),n()(t,"rules",{productId:[{required:!0,message:"商品编号不能为空",trigger:"blur"}],commodityName:[{required:!0,message:"严选商品名称不能为空",trigger:"blur"}],rent:[{required:!0,message:"严选商品租金不能为空",trigger:"blur"}]}),n()(t,"editorInit",{language:"zh_CN",convert_urls:!1,plugins:["advlist anchor autolink autosave code codesample colorpicker colorpicker contextmenu directionality emoticons fullscreen hr image imagetools importcss insertdatetime link lists media nonbreaking noneditable pagebreak paste preview print save searchreplace spellchecker tabfocus table template textcolor textpattern visualblocks visualchars wordcount"],toolbar:["searchreplace bold italic underline strikethrough alignleft aligncenter alignright outdent indent  blockquote undo redo removeformat subscript superscript code codesample","hr bullist numlist link image charmap preview anchor pagebreak insertdatetime media table emoticons forecolor backcolor fullscreen"]}),t},watch:{selectProductTypeValue:function(t){null!=t&&2===t.length?this.product.productType=t[1]:this.product.productType=null}},created:function(){this.init()},mounted:function(){},methods:{init:function(){var t=this;if(null!=this.$route.query.commodityId){var i=new URLSearchParams;i.append("commodityId",this.$route.query.commodityId),i.append("queryType",this.$route.query.queryType),Object(l.g)(i).then(function(i){t.commodity.commodityName=i.data.commodityName,t.commodity.commodityId=i.data.commodityId,t.commodity.brand=i.data.brand,t.commodity.location=i.data.location,t.commodity.model=i.data.model,t.commodity.introduce=i.data.introduce,t.commodity.companyName=i.data.companyName,t.commodity.rent=i.data.rent,t.commodity.commodityIcon=i.data.commodityIcon,t.commodityIconArray=i.data.commodityIcon.split(","),console.log("commodityIconArray.length："+t.commodityIconArray.length),t.commodity.unit=i.data.unit,t.commodity.power=i.data.power,t.commodity.scoreProportion=i.data.scoreProportion,t.commodity.material=i.data.material,t.commodity.productionPlace=i.data.productionPlace,t.commodity.productProfile=i.data.productProfile,t.commodity.specification=i.data.specification;i.data.productType;t.specifications=i.data.specificationsList,t.stocks=i.data.stockList,t.attributes=i.data.attributes}).catch(function(t){console.log(t)})}},beforeUploadImage:function(t){return this.product.append("file",t),!1},handleCategoryChange:function(t){this.product.categoryId=t[t.length-1]},handleCancel:function(){this.$router.push({path:"/pms/product"})},handleEdit:function(){for(var t=this,i="",o=0;o<this.commodityIconArray.length;o++)console.log(this.commodityIconArray[o]),i=i+this.commodityIconArray[o]+",";this.commodity.commodityIcon=i.substring(0,i.length-1),console.log("commodityIcon----"+this.commodity.commodityIcon);var e={commodity:this.commodity,specifications:this.specifications,stocks:this.stocks,attributes:this.attributes};console.log("commodityIconArray.length----"+this.commodityIconArray.length),console.log("commodityIconArray----"+this.commodityIconArray),console.log("commodity----"+a()(e.commodity)),console.log("product----"+a()(e.product)),console.log("specifications----"+a()(e.specifications)),console.log("stocks----"+a()(e.stocks)),console.log("attributes----"+a()(e.attributes));var c=new URLSearchParams;c.append("stocks",a()(this.stocks)),c.append("commodity",a()(this.commodity)),c.append("specification",a()(this.specifications)),c.append("attributes",a()(this.attributes)),c.append("finalGoods",a()(e.product)),Object(l.h)(c).then(function(i){t.$notify.success({title:"成功",message:"更新成功"}),t.$router.push({path:"/wms/commodity"})}).catch(function(t){m.MessageBox.alert("业务错误："+t.data.errmsg,"警告",{confirmButtonText:"确定",type:"error"})})},handleResetSearch:function(){this.selectProductTypeValue=[],this.listQuery=c()({},defaultListQuery)},handleClose:function(t){this.keywords.splice(this.keywords.indexOf(t),1),this.product.keywords=this.keywords.toString()},showInput:function(){var t=this;this.newKeywordVisible=!0,this.$nextTick(function(i){t.$refs.newKeywordInput.$refs.input.focus()})},handleInputConfirm:function(){var t=this.newKeyword;t&&(this.keywords.push(t),this.product.keywords=this.keywords.toString()),this.newKeywordVisible=!1,this.newKeyword=""},uploadPicUrl:function(t){this.product.productIcon=t.data},uploadOverrun:function(){this.$message({type:"error",message:"上传文件个数超出限制!最多上传5张图片!"})},handleGalleryUrl:function(t,i,o){0===t.errno&&this.product.gallery.push(t.data)},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},handleRemove:function(t,i){for(var o=0;o<this.product.gallery.length;o++){var e;e=void 0===t.response?t.url:t.response.data,this.product.gallery[o]===e&&this.product.gallery.splice(o,1)}},beforeAvatarUpload:function(t){var i="image/jpeg"===t.type,o="image/png"===t.type,e=t.size/1024/1024<2;return i||o||this.$message.error("上传图片只能是 JPG或png 格式!"),e||this.$message.error("上传图片大小不能超过 2MB!"),(i||o)&&e},uploadFile:function(t){return this.params.append("file",t.file),!1},specChanged:function(t){!1===t?(this.specifications=[{specification:"规格",value:"标准",picUrl:""}],this.stocks=[{stockId:0,specifications:["标准"],salePrice:0,stock:0,url:""}]):(this.specifications=[],this.stocks=[])},uploadSpecPicUrl:function(t){this.specForm.picUrl=t.data},handleSpecificationShow:function(){this.specForm={specification:"",value:"",picUrl:""},this.specVisiable=!0},handleSpecificationAdd:function(){for(var t=this.specifications.length-1,i=0;i<this.specifications.length;i++){this.specifications[i].specification===this.specForm.specification&&(t=i)}this.specifications.splice(t+1,0,this.specForm),this.specVisiable=!1,this.specToProduct()},handleSpecificationDelete:function(t){var i=this.specifications.indexOf(t);this.specifications.splice(i,1),this.specToProduct()},specToProduct:function(){if(0!==this.specifications.length){var t=[],i=this.specifications[0].specification,o=[];o.push(0);for(var e=1;e<this.specifications.length;e++){var c=this.specifications[e].specification;c===i?o.push(e):(t.push(o),i=c,(o=[]).push(e))}t.push(o);for(var s=0,a=[],r=[],n=t.length,l=0;l<n;l++)r[l]=0;var d=0,m=!1;do{for(var u=[],p=0;p<n;p++){var h=t[p][r[p]];u.push(this.specifications[h].value)}a[s]={stockId:s,specifications:u,salePrice:0,stock:0,url:""},s++,d++,r[n-1]=d;for(var y=n-1;y>=0;y--)r[y]>=t[y].length&&(r[y]=0,d=0,y-1>=0&&(r[y-1]=r[y-1]+1));m=!1;for(var f=0;f<n;f++)0!==r[f]&&(m=!0)}while(m);this.stocks=a}},handleProductShow:function(t){this.productForm=c()({},t),this.productVisiable=!0},uploadProductUrl:function(t){this.productForm.url=t.data.url},handleProductEdit:function(){console.log(this.stocks);for(var t=0;t<this.stocks.length;t++){if(this.stocks[t].stockId===this.productForm.id){this.stocks.splice(t,1,this.productForm);break}}this.productVisiable=!1},handleAttributeShow:function(){this.attributeForm={},this.attributeVisiable=!0},handleAttributeAdd:function(){this.attributes.unshift(this.attributeForm),this.attributeVisiable=!1},handleAttributeDelete:function(t){var i=this.attributes.indexOf(t);this.attributes.splice(i,1)},showmask:function(t){this.$refs.mask[t].style.display="block"},hiddenmask:function(t){this.$refs.mask[t].style.display="none"},scaleImg:function(t){this.dialogVisible=!0,this.dialogImageUrl=this.commodityIconArray[t]},deleteImg:function(t){this.commodityIconArray.splice(t,1),this.fileList.splice(t,1)},muluploadSuccess:function(t){this.commodityIconArray.push(t.data);var i;i={name:"file",url:t.data},this.fileList.push(i)}}}),y={render:function(){var t=this,i=t.$createElement,o=t._self._c||i;return o("div",{staticClass:"app-container"},[o("el-card",{staticClass:"box-card"},[o("h3",[t._v("商品介绍")]),t._v(" "),o("el-form",{ref:"product",attrs:{rules:t.rules,model:t.commodity,"label-width":"150px"}},[o("el-form-item",{attrs:{label:"商品名称",prop:"commodityName"}},[o("el-input",{model:{value:t.commodity.commodityName,callback:function(i){t.$set(t.commodity,"commodityName",i)},expression:"commodity.commodityName"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"商品品牌："}},[o("el-input",{model:{value:t.commodity.brand,callback:function(i){t.$set(t.commodity,"brand",i)},expression:"commodity.brand"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"地址："}},[o("el-input",{model:{value:t.commodity.location,callback:function(i){t.$set(t.commodity,"location",i)},expression:"commodity.location"}})],1),t._v(" "),o("el-form-item",{staticStyle:{width:"1400px"},attrs:{label:"租金：",prop:"rent"}},[o("el-input",{model:{value:t.commodity.rent,callback:function(i){t.$set(t.commodity,"rent",i)},expression:"commodity.rent"}},[o("template",{slot:"append"},[o("el-input",{staticStyle:{width:"100px"},model:{value:t.commodity.unit,callback:function(i){t.$set(t.commodity,"unit",i)},expression:"commodity.unit"}})],1)],2)],1),t._v(" "),o("el-form-item",{attrs:{label:"商品图片"}},[t.commodityIconArray?o("ul",{staticClass:"img-box"},t._l(t.commodityIconArray,function(i,e){return o("li",{key:e,staticClass:"img-item",on:{mouseenter:function(i){return t.showmask(e)},mouseleave:function(i){return t.hiddenmask(e)}}},[o("div",{ref:"mask",refInFor:!0,staticClass:"mask"},[o("i",{staticClass:"el-icon-zoom-in",on:{click:function(i){return t.scaleImg(e)}}}),t._v(" "),o("i",{staticClass:"el-icon-delete",on:{click:function(i){return t.deleteImg(e)}}})]),t._v(" "),o("img",{staticClass:"avatar",attrs:{src:i}})])}),0):t._e(),t._v(" "),t.commodityIconArray.length<5?o("ul",[o("el-upload",{attrs:{action:t.uploadPath,"on-success":t.muluploadSuccess,"show-file-list":!1,"list-type":"picture-card",limit:1,"file-list":t.fileList,multiple:""}},[o("i",{staticClass:"el-icon-plus avatar-uploader-icon",staticStyle:{width:"150px",height:"150px"}})])],1):t._e(),t._v(" "),o("el-dialog",{attrs:{visible:t.dialogVisible,size:"tiny"},on:{"update:visible":function(i){t.dialogVisible=i}}},[o("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1),t._v(" "),o("el-form-item",{attrs:{label:"商品型号："}},[o("el-input",{model:{value:t.commodity.model,callback:function(i){t.$set(t.commodity,"model",i)},expression:"commodity.model"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"商品规格："}},[o("el-input",{model:{value:t.commodity.specification,callback:function(i){t.$set(t.commodity,"specification",i)},expression:"commodity.specification"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"商品详细介绍"}},[o("quillEditor",{ref:"myTextEditor",attrs:{options:t.quillOption},model:{value:t.commodity.introduce,callback:function(i){t.$set(t.commodity,"introduce",i)},expression:"commodity.introduce"}})],1)],1)],1),t._v(" "),o("div",{staticClass:"op-container"},[o("el-button",{on:{click:t.handleCancel}},[t._v("取消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.handleEdit}},[t._v("更新商品")])],1)],1)},staticRenderFns:[]};var f=o("VU/8")(h,y,!1,function(t){o("a3w2")},null,null);i.default=f.exports},a3w2:function(t,i){}});
//# sourceMappingURL=46.f8384da0798e0c30be86.js.map